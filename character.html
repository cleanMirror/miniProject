<!DOCTYPE html>
<html>

<head>
    <script src="https://code.jquery.com/jquery-3.7.1.js"
        integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <meta charset="EUC-KR">
    <title>Insert title here</title>
    <link rel="stylesheet" href="css/total.css">
</head>

<body>
    <div id="app">
        <header id="header">
            <div class="Logo">Logo</div>
            <div class="menuItem" @click="fnNavProfile">프로필</div>
            <div class="menuItem" @click="fnNavChar">캐릭터 통계</div>
            <div class="button" @click="fnLogout">로그아웃</div>
            <div class="button" @click="fnNavInit">전적 갱신</div>
        </header>
        <section id="charContainer" class="boxEffect">
            <h3>캐릭터 통계</h3>
            <table id="tableStats">
                <tr>
                    <th>캐릭터</th>
                    <th>평균 순위</th>
                    <th>평균 딜량</th>
                    <th>평균 탱킹</th>
                    <th>평균 힐량</th>
                    <th>평균 RP 획득량</th>
                </tr>
                <tr v-for="item of charInfo">
                    <td class="statsChar">
                        <div class="statsCharImg">charImg</div>
                        <div>
                            <div>{{item.CHARACTER_NUM}}</div>
                            <div>{{item.MATCHES}}판</div>
                        </div>
                    </td>
                    <td>{{item.GAME_RANK}}</td>
                    <td>{{item.DAMAGE_TO_PLAYER}}</td>
                    <td>{{item.DAMAGE_FROM_PLAYER}}</td>
                    <td>{{item.TEAM_RECOVER}}</td>
                    <td>{{item.MMR_GAIN}}</td>
                </tr>
            </table>
        </section>
        <footer id="footer">
            <div>footer</div>
        </footer>
    </div>
</body>
<script>
    const app = Vue.createApp({
        data() {
            return {
                charInfo : []
            };
        },
        methods: {
            fnNavProfile() {
                location.href = "profile.html";
            },
            fnNavChar() {
                location.href = "character.html";
            },
            fnLogout() {
                sessionStorage.removeItem("userInfo");
                location.href = "login.html";
            },
            fnNavInit() {
                alert("새로고침 버튼");
            },
            fnLoginCheck() {
                var session = sessionStorage.getItem("userInfo");
                if (session == null) {
                    alert("로그인이 필요합니다.");
                    location.href = "login.html";
                }
            },
            fnDataInit() {
                var userId = JSON.parse(sessionStorage.getItem("userInfo") ).USERNUM;
                
                $.ajax({
                   url: `http://localhost:3000/charInit`,
                   dataType: "json",
                   type: "POST",
                   data: JSON.stringify({"userId" : userId}),
                   contentType: "application/json",
                   success: (data) => {
                        this.charInfo = data;
                        console.log(this.charInfo);
                   }
                });
            }
        },
        mounted() {
            this.fnLoginCheck();
            this.fnDataInit();
        }
    });
    app.mount('#app');
</script>

</html>